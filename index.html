<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Near</title>
    <meta name="description" content="A D&D dice roller and weapon calculator for tabletop gaming">
    
    <!-- Favicon pack -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#9d4edd">
    <meta name="msapplication-TileColor" content="#9d4edd">
    <meta name="theme-color" content="#9d4edd">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="D&D Near">

    // Register service worker for PWA functionality
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./js/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <main class="dnd-calculator">
        <!-- Integrated logo and title into the main panel -->
        <div class="calculator-header">
            <div class="logo-container">
                <img src="img/dnd-near-logo.svg" type="image/svg" alt="D&D Near Logo">
            </div>
        </div>
        
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" data-tab="dice-roller">Dice Roller</button>
                <button class="tab-button" data-tab="custom-calculator">Solstora Calculator</button>
            </div>
            
            <!-- Dice Roller Tab -->
            <div id="dice-roller" class="tab-content active">
                <div class="dice-section">
                    <button class="dice-button" data-dice="4">D4</button>
                    <button class="dice-button" data-dice="6">D6</button>
                    <button class="dice-button" data-dice="8">D8</button>
                    <button class="dice-button" data-dice="10">D10</button>
                    <button class="dice-button" data-dice="12">D12</button>
                    <button class="dice-button" data-dice="20">D20</button>
                    <button class="dice-button" data-dice="100">D100</button>
                </div>
                
                <div class="modifier-section">
                    <label>
                        Number of dice: 
                        <input type="number" id="dice-quantity" class="quantity-input" value="1" min="1" max="20">
                    </label>
                    <label>
                        Modifier: 
                        <input type="number" id="modifier" class="modifier-input" value="0">
                    </label>
                </div>
                
                <button id="roll-button" class="roll-button">Roll!</button>
                
                <div class="result-section">
                    <div class="result-display" id="result">-</div>
                    <div class="result-details" id="result-details"></div>
                </div>
                
                <div class="advanced-section">
                    <div class="custom-roll-section">
                        <input type="number" id="custom-quantity" class="quantity-input" value="1" min="1" max="20">
                        <span>d</span>
                        <input type="number" id="custom-dice" value="20" min="1" max="1000">
                        +
                        <input type="number" id="custom-modifier" class="modifier-input" value="0">
                        <button id="custom-roll-button" class="dice-button">Roll Custom</button>
                    </div>
                </div>
            </div>
            
            <!-- Custom Calculator Tab -->
            <div id="custom-calculator" class="tab-content">
                <h3>Solstora Calculator</h3>
                <div class="solstora-description">
                    <div class="item-image-container">
                        <img src="https://darksouls3.wiki.fextralife.com/file/Dark-Souls-3/astora_greatsword.png" alt="Solstora Greatsword" class="item-image">
                    </div>
                    <div class="item-description">
                        <h4>Solstora</h4>
                        <p class="weapon-type">Greatsword (Heavy, Two-Handed, Graze)</p>
                        <div class="weapon-properties">
                            <div class="property"><strong>Attack Type:</strong> Melee</div>
                            <div class="property"><strong>Reach:</strong> 5ft</div>
                            <div class="property"><strong>Weight:</strong> 6 lbs</div>
                            <div class="property damage-row"><strong>Damage:</strong> 
                                <span class="damage-value">
                                    2d6+<span id="damage-str-mod">4</span> 
                                    <img src="img/damage-icons/slashing.svg" class="damage-icon slashing-icon" alt="Slashing">
                                    Slashing + 1d8
                                    <img src="img/damage-icons/lightning.svg" class="damage-icon lightning-icon" alt="Lightning">
                                    Lightning
                                </span>
                            </div>
                            <div class="property">
                                <strong>Damage Type:</strong> 
                                <span class="damage-type">
                                    <img src="img/damage-icons/slashing.svg" class="damage-icon slashing-icon" alt="Slashing">
                                    Slashing +
                                    <img src="img/damage-icons/lightning.svg" class="damage-icon lightning-icon" alt="Lightning">
                                    Lightning
                                </span>
                            </div>
                        </div>
                        <p>A sword with no currently known origin, it bends to the will of its owner, only being able to be used by those who exude radiance in any shape or form.</p>
                        <p><em>"Radiance is a virtue, nevertheless, I became an Undead to pursue this!" - Solaire of Astora</em></p>
                        <p><em>"I owe this to you. Thank you. Truly. ****** we've done it. We really have..." - Unknown</em></p>
                    </div>
                </div>
                <p>Calculate your attack rolls with the legendary Solstora.</p>
                
                <!-- Weapon Attack Calculator -->
                <div class="custom-calculator">
                    <div class="form-group">
                        <label>Strength Score:</label>
                        <input type="number" id="str-score" class="form-control" value="10" min="1" max="30">
                    </div>
                    
                    <div class="form-group">
                        <label>Strength Modifier:</label>
                        <input type="text" id="str-mod" class="form-control" readonly value="+0">
                    </div>
                    
                    <div class="form-group">
                        <label>Proficiency Bonus:</label>
                        <input type="number" id="prof-bonus" class="form-control" value="2" min="0" max="6">
                    </div>
                    
                    <div class="form-group">
                        <label>Additional Attack Bonus:</label>
                        <input type="number" id="attack-bonus" class="form-control" value="0" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>Total Attack Modifier:</label>
                        <input type="text" id="total-attack-mod" class="form-control" readonly value="+2">
                    </div>
                    
                    <div class="combat-features">
                        <h4>Combat Features</h4>
                        
                        <!-- Weapon Mastery -->
                        <div class="feature-checkbox">
                            <input type="checkbox" id="weapon-mastery" name="weapon-mastery">
                            <label for="weapon-mastery">Greatsword Weapon Mastery (Proficient)</label>
                            <span class="feature-info" data-feature="weapon-mastery">i</span>
                            <div class="feature-tooltip" id="weapon-mastery-tooltip">
                                <h5>Greatsword Weapon Mastery</h5>
                                <p class="prerequisites">Prerequisite: Proficiency with greatswords</p>
                                <div class="benefit">
                                    <p>Your training with weapons allows you to use the mastery property of Greatswords:</p>
                                    <p class="benefit-item"><strong>Graze.</strong> If your attack roll with a Greatsword misses a creature, you can deal damage to that creature equal to the ability modifier you used to make the attack roll. This damage is the same type dealt by the Greatsword, and the damage can be increased only by increasing the ability modifier.</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Great Weapon Master -->
                        <div class="feature-checkbox">
                            <input type="checkbox" id="great-weapon-master" name="great-weapon-master">
                            <label for="great-weapon-master">Great Weapon Master</label>
                            <span class="feature-info" data-feature="great-weapon-master">i</span>
                            <div class="feature-tooltip" id="great-weapon-master-tooltip">
                                <h5>Great Weapon Master</h5>
                                <p class="prerequisites">Prerequisite: Level 4+, Strength 13+</p>
                                <div class="benefit">
                                    <p>You gain the following benefits:</p>
                                    <p class="benefit-item"><strong>Ability Score Increase.</strong> Increase your Strength score by 1, to a maximum of 20.</p>
                                    <p class="benefit-item"><strong>Heavy Weapon Mastery.</strong> When you hit a creature with a weapon that has the Heavy property as part of the Attack action on your turn, you can cause the weapon to deal extra damage to the target. The extra damage equals your Proficiency Bonus.</p>
                                    <p class="benefit-item"><strong>Hew.</strong> Immediately after you score a Critical Hit with a Melee weapon or reduce a creature to 0 Hit Points with one, you can make one attack with the same weapon as a Bonus Action.</p>
                                    <p class="action">Hew: 1 Bonus Action</p>
                                    <p class="action">Heavy Weapon Mastery: 1 Action</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Great Weapon Fighting -->
                        <div class="feature-checkbox">
                            <input type="checkbox" id="great-weapon-fighting" name="great-weapon-fighting">
                            <label for="great-weapon-fighting">Great Weapon Fighting</label>
                            <span class="feature-info" data-feature="great-weapon-fighting">i</span>
                            <div class="feature-tooltip" id="great-weapon-fighting-tooltip">
                                <h5>Great Weapon Fighting</h5>
                                <p class="prerequisites">Fighting Style Feat (Prerequisite: Fighting Style Feature)</p>
                                <div class="benefit">
                                    <p>When you roll damage for an attack you make with a Melee weapon that you are holding with two hands, you can treat any 1 or 2 on a damage die as a 3. The weapon must have the Two-Handed or Versatile property to gain this benefit.</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Savage Attacker -->
                        <div class="feature-checkbox">
                            <input type="checkbox" id="savage-attacker" name="savage-attacker">
                            <label for="savage-attacker">Savage Attacker</label>
                            <span class="feature-info" data-feature="savage-attacker">i</span>
                            <div class="feature-tooltip" id="savage-attacker-tooltip">
                                <h5>Savage Attacker</h5>
                                <p class="prerequisites">Soldier Origin Feat</p>
                                <div class="benefit">
                                    <p>You've trained to deal particularly damaging strikes. Once per turn when you hit a target with a weapon, you can roll the weapon's damage dice twice and use either roll against the target.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="roll-options">
                        <div class="roll-option-title">Roll With:</div>
                        <div class="roll-options-container">
                            <label class="roll-option-card">
                                <input type="radio" name="roll-type" value="advantage" id="roll-advantage">
                                <div class="radio-indicator"></div>
                                <div class="option-content">
                                    <div class="option-icon advantage-icon">
                                        <img src="img/roll-icons/advantage.svg" alt="Advantage">
                                    </div>
                                    <div class="option-label">Advantage</div>
                                </div>
                            </label>
                            
                            <label class="roll-option-card">
                                <input type="radio" name="roll-type" value="normal" id="roll-normal" checked>
                                <div class="radio-indicator"></div>
                                <div class="option-content">
                                    <div class="option-icon normal-icon">
                                        <img src="img/roll-icons/flat-roll.svg" alt="Flat Roll">
                                    </div>
                                    <div class="option-label">Flat Roll</div>
                                </div>
                            </label>
                            
                            <label class="roll-option-card">
                                <input type="radio" name="roll-type" value="disadvantage" id="roll-disadvantage">
                                <div class="radio-indicator"></div>
                                <div class="option-content">
                                    <div class="option-icon disadvantage-icon">
                                        <img src="img/roll-icons/disadvantage.svg" alt="Disadvantage">
                                    </div>
                                    <div class="option-label">Disadvantage</div>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <button id="roll-attack" class="roll-button">Roll to Hit</button>
    
                    <!-- Damage Roll Options -->
                    <div class="roll-options">
                        <div class="roll-option-title">Damage Roll Type:</div>
                        <div class="roll-options-container">
                            <label class="roll-option-card">
                                <input type="radio" name="damage-roll-type" value="critical" id="damage-roll-critical">
                                <div class="radio-indicator"></div>
                                <div class="option-content">
                                    <div class="option-icon critical-icon">
                                        <svg viewBox="0 0 48 48">
                                            <g>
                                                <circle cx="24" cy="24" r="22" fill="#FF5555" stroke="#FFFFFF" stroke-width="2"/>
                                                <path d="M24 10L26 18H34L28 24L30 32L24 28L18 32L20 24L14 18H22L24 10Z" fill="#FFFFFF"/>
                                            </g>
                                        </svg>
                                    </div>
                                    <div class="option-label">Critical Hit</div>
                                </div>
                            </label>

                            <label class="roll-option-card">
                                <input type="radio" name="damage-roll-type" value="normal" id="damage-roll-normal" checked>
                                <div class="radio-indicator"></div>
                                <div class="option-content">
                                    <div class="option-icon normal-icon">
                                        <img src="img/roll-icons/flat-roll.svg" alt="Flat Roll">
                                    </div>
                                    <div class="option-label">Flat Roll</div>
                                </div>
                            </label>
                            
                            <label class="roll-option-card">
                                <input type="radio" name="damage-roll-type" value="graze" id="damage-roll-graze">
                                <div class="radio-indicator"></div>
                                <div class="option-content">
                                    <div class="option-icon graze-icon">
                                        <svg viewBox="0 0 48 48">
                                            <g>
                                                <circle cx="24" cy="24" r="20" fill="#3a3a3c" stroke="#FFFFFF" stroke-width="2"/>
                                                <path d="M14 24H34" stroke="#9d4edd" stroke-width="4" stroke-linecap="round"/>
                                                <path d="M18 16L14 24L18 32" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round"/>
                                                <path d="M30 16L34 24L30 32" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round"/>
                                            </g>
                                        </svg>
                                    </div>
                                    <div class="option-label">Graze (Miss)</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <button id="roll-damage" class="roll-button damage-roll-button">Roll Damage</button>

                    <div class="result-section">
                        <div class="result-display" id="attack-result">-</div>
                        <div class="result-details" id="attack-result-details"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Shared History Section -->
        <div class="history-section">
            <h3>Roll History</h3>
            <div class="history-list" id="history-list"></div>
        </div>
    </main>

    <!-- JavaScript files -->
    <script src="js/roll.js"></script>
    <script src="js/dice-roller.js"></script>
    <script src="js/weapon-calculator.js"></script>
    <script src="js/app.js"></script>
    <script src="js/persistence.js"></script>
</body>
</html>